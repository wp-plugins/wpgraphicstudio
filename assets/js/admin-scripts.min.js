jQuery(document).ready(function(b){var d={init:function(){this.add();this.move();this.remove();this.type();this.prices();this.files()},clone_repeatable:function(f){clone=f.clone();clone.find("select").each(function(){b(this).val(f.find('select[name="'+b(this).attr("name")+'"]').val())});var e=f.parent().find("tr").length-1;clone.removeClass("wpgs_add_blank");clone.find("td input, td select").val("");clone.find("input, select").each(function(){var g=b(this).attr("name");g=g.replace(/\[(\d+)\]/,"["+parseInt(e)+"]");b(this).attr("name",g).attr("id",g)});return clone},add:function(){b("body").on("click",".submit .wpgs_add_repeatable",function(g){g.preventDefault();var f=b(this),h=f.parent().parent().prev("tr"),i=d.clone_repeatable(h);i.insertAfter(h)})},move:function(){},remove:function(){b("body").on("click",".wpgs_remove_repeatable",function(f){f.preventDefault();var g=b(this).parent().parent("tr"),h=g.parent().find("tr").length-1,i=b(this).data("type"),j="tr.wpgs_repeatable_"+i+"s";if(h>1){b("input, select",g).val("");g.fadeOut("fast").remove()}else{switch(i){case"price":alert(wpgs_vars.one_price_min);break;case"file":alert(wpgs_vars.one_file_min);break;default:alert(wpgs_vars.one_field_min);break}}b(j).each(function(e){b(this).find("input, select").each(function(){var k=b(this).attr("name");k=k.replace(/\[(\d+)\]/,"["+e+"]");b(this).attr("name",k).attr("id",k)})})})},type:function(){b("body").on("change","#wpgs_product_type",function(f){b("#wpgs_download_files").toggle();b("#wpgs_products").toggle();b("#wpgs_download_limit_wrap").toggle()})},prices:function(){b("body").on("change","#wpgs_variable_pricing",function(f){b(".wpgs_pricing_fields").toggle();b(".wpgs_repeatable_condition_field").toggle();b("#wpgs_download_files table .pricing").toggle()})},files:function(){if(typeof wp=="undefined"||wpgs_vars.new_media_ui!="1"){if(b(".wpgs_upload_image_button").length>0){window.formfield="";b("body").on("click",".wpgs_upload_image_button",function(f){f.preventDefault();window.formfield=b(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(wpgs_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2000);if(wpgs_vars.post_id!=null){var g="post_id="+wpgs_vars.post_id+"&"}tb_show(wpgs_vars.add_new_download,"media-upload.php?"+g+"TB_iframe=true")});window.wpgs_send_to_editor=window.send_to_editor;window.send_to_editor=function(f){if(window.formfield){imgurl=b("a","<div>"+f+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.wpgs_send_to_editor(f)}window.send_to_editor=window.wpgs_send_to_editor;window.formfield="";window.imagefield=false}}}else{var e;window.formfield="";b("body").on("click",".wpgs_upload_image_button",function(f){f.preventDefault();var g=b(this);window.formfield=b(this).closest(".wpgs_repeatable_upload_wrapper");if(e){e.open();return}e=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:g.data("uploader_title"),button:{text:g.data("uploader_button_text"),},multiple:b(this).data("multiple")=="0"?false:true});e.on("menu:render:default",function(h){var i={};h.unset("library-separator");h.unset("gallery");h.unset("featured-image");h.unset("embed");h.set(i)});e.on("insert",function(){var h=e.state().get("selection");h.each(function(j,i){j=j.toJSON();if(i==0){window.formfield.find(".wpgs_repeatable_upload_field").val(j.url);window.formfield.find(".wpgs_repeatable_name_field").val(j.title)}else{var k=window.formfield,l=d.clone_repeatable(k);l.find(".wpgs_repeatable_upload_field").val(j.url);if(j.title.length>0){l.find(".wpgs_repeatable_name_field").val(j.title)}else{l.find(".wpgs_repeatable_name_field").val(j.filename)}l.insertAfter(k)}})});e.open()});var e;window.formfield=""}}};d.init();if(b(".form-table .wpgs_datepicker").length>0){var a="mm/dd/yy";b(".wpgs_datepicker").datepicker({dateFormat:a})}b("#purchased-downloads").on("click",".wpgs-remove-purchased-download",function(){var e=b(this);data={action:e.data("action"),download_id:e.data("id")};b.post(ajaxurl,data,function(f){if(f!="fail"){b(".purchased_download_"+e.data("id")).remove()}});return false});b("#wpgs-add-downloads-to-purchase").on("click",".wpgs-add-another-download",function(){var f=b("#wpgs-add-downloads-to-purchase select.wpgs-downloads-list:last").parent().clone(),g=b("#wpgs-add-downloads-to-purchase select.wpgs-downloads-list").length,e=b("#wpgs-add-downloads-to-purchase select.wpgs-downloads-list:last").parent();if(f.has("select.wpgs-variable-prices-select")){b("select.wpgs-variable-prices-select",f).remove()}b(f).children("select").prop("name","downloads["+g+"][id]");f.insertAfter(e);return false});b("#wpgs-add-downloads-to-purchase").on("change","select.wpgs-downloads-list",function(){var f=b(this),e=b("option:selected",f).val(),h=b("#wpgs-add-downloads-to-purchase select").length-1;if(parseInt(e)!=0){var g={action:"wpgs_check_for_download_price_variations",download_id:e,array_key:h,nonce:b("#wpgs_add_downloads_to_purchase_nonce").val()};b(".wpgs_add_download_to_purchase_waiting:last").removeClass("hidden");b.post(ajaxurl,g,function(i){f.next("select").remove();f.after(i);if(!b(".wpgs-remove-download",f.parent()).length&&b("#wpgs-add-downloads-to-purchase select.wpgs-downloads-list").length>1){f.parent().append('Â <a href="#" class="wpgs-remove-download">'+wpgs_vars.remove_text+"</a>")}b(".wpgs_add_download_to_purchase_waiting:last").addClass("hidden")})}else{f.next("select").remove();b(".wpgs_add_download_to_purchase_waiting:last").addClass("hidden")}});b("#wpgs-add-downloads-to-purchase").on("click",".wpgs-remove-download",function(){b(this).parent().remove();return false});b("#wpgs-add-download").on("click",function(){b("#wpgs-add-downloads-to-purchase select.wpgs-downloads-list").each(function(){var g=b("option:selected",this).val();if(b(this).next().hasClass("wpgs-variable-prices-select")){var f=b("option:selected",b(this).next()).val(),e=b("option:selected",b(this).next()).text(),h='<input type="hidden" name="wpgs-purchased-downloads['+g+'][options][price_id]" value="'+f+'"/> ('+e+")"}else{var f="",h=""}data={action:"wpgs_get_download_title",download_id:g};b.post(ajaxurl,data,function(i){if(i!="fail"){var j='<div class="purchased_download_'+g+'"><input type="hidden" name="wpgs-purchased-downloads['+g+']" value="'+g+'"/><strong>'+i+h+'</strong> - <a href="#" class="wpgs-remove-purchased-download" data-action="remove_purchased_download" data-id="'+g+'">Remove</a></div>';b(j).insertBefore("#edit-downloads")}})});tb_remove();return false});b("#wpgs_payment_status").change(function(){if(b("#wpgs_payment_status option:selected").val()=="publish"){b("#wpgs_payment_notification").slideDown()}else{b("#wpgs_payment_notification").slideUp()}});b(".download_page_wpgs-payment-history .row-actions .delete a").on("click",function(){if(confirm(wpgs_vars.delete_payment)){return true}return false});b(".wpgs-delete-payment-note").on("click",function(){if(confirm(wpgs_vars.delete_payment_note)){return true}return false});b("#the-list").on("click",".editinline",function(){inlineEditPost.revert();var g=b(this).closest("tr").attr("id");g=g.replace("post-","");var e=b("#post-"+g);var f=e.find(".column-price .downloadprice-"+g).val();if(f!=b("#post-"+g+".column-price .downloadprice-"+g).val()){b(".regprice","#wpgs-download-data").val(f).attr("disabled",false)}else{b(".regprice","#wpgs-download-data").val(wpgs_vars.quick_edit_warning).attr("disabled","disabled")}});if(b("#email-preview-wrap").length){b("#open-email-preview").colorbox({inline:true,href:"#email-preview",width:"80%",height:"auto"})}b("#wpgs-graphs-date-options").change(function(){var e=b(this);if(e.val()=="other"){b("#wpgs-date-range-options").show()}else{b("#wpgs-date-range-options").hide()}});b("#wpgs_customer_export_download").change(function(){var e=b(this);if(e.val()=="0"){b("#wpgs_customer_export_option").show()}else{b("#wpgs_customer_export_option").hide()}});b('select[name="wpgs_settings_taxes[base_country]"]').change(function(){var f=b(this),e=f.closest("tr");data={action:"wpgs_get_shop_states",country:b(this).val(),field_name:"wpgs_settings_taxes[base_state]"};b.post(ajaxurl,data,function(g){if("nostates"==g){e.next().hide()}else{e.next().show();e.next().find("select").replaceWith(g)}});return false});b("body").on("change","#wpgs_tax_rates select",function(){var e=b(this);data={action:"wpgs_get_shop_states",country:b(this).val(),field_name:e.attr("name").replace("country","state")};b.post(ajaxurl,data,function(f){if("nostates"==f){var g='<input type="text" name="'+data.field_name+'" value=""/>';e.parent().next().find("select").replaceWith(g)}else{e.parent().next().find("input,select").show();e.parent().next().find("input,select").replaceWith(f)}});return false});b("#wpgs_add_tax_rate").on("click",function(){var e=b("#wpgs_tax_rates tr:last");var g=e.clone();var f=e.parent().find("tr").length;g.find("td input").val("");g.find("input, select").each(function(){var h=b(this).attr("name");h=h.replace(/\[(\d+)\]/,"["+parseInt(f)+"]");b(this).attr("name",h).attr("id",h)});g.insertAfter(e);return false});b("body").on("click","#wpgs_tax_rates .wpgs_remove_tax_rate",function(){if(confirm(wpgs_vars.delete_tax_rate)){b(this).closest("tr").remove()}return false});if(b('select[name="wpgs_settings_misc[download_method]"]:selected').val()!="direct"){b('select[name="wpgs_settings_misc[download_method]"]').parent().parent().next().hide();b('select[name="wpgs_settings_misc[download_method]"]').parent().parent().next().find("input").attr("checked",false)}b('select[name="wpgs_settings_misc[download_method]"]').on("change",function(){var e=b(this).parent().parent().next();if(b(this).val()=="direct"){e.hide()}else{e.show();e.find("input").attr("checked",false)}});if(typeof wp=="undefined"||wpgs_vars.new_media_ui!="1"){if(b(".wpgs_settings_upload_button").length>0){window.formfield="";b("body").on("click",".wpgs_settings_upload_button",function(f){f.preventDefault();window.formfield=b(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(wpgs_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2000);tb_show(wpgs_vars.add_new_download,"media-upload.php?TB_iframe=true")});window.wpgs_send_to_editor=window.send_to_editor;window.send_to_editor=function(e){if(window.formfield){imgurl=b("a","<div>"+e+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.wpgs_send_to_editor(e)}window.send_to_editor=window.wpgs_send_to_editor;window.formfield="";window.imagefield=false}}}else{var c;window.formfield="";b("body").on("click",".wpgs_settings_upload_button",function(f){f.preventDefault();var g=b(this);window.formfield=b(this).parent().prev();if(c){c.open();return}c=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:g.data("uploader_title"),button:{text:g.data("uploader_button_text"),},multiple:false});c.on("menu:render:default",function(e){var h={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(h)});c.on("insert",function(){var e=c.state().get("selection");e.each(function(h,i){h=h.toJSON();window.formfield.val(h.url)})});c.open()});var c;window.formfield=""}b("body").on("click","#bulk_edit",function(){var g=b("#bulk-edit");var f=new Array();g.find("#bulk-titles").children().each(function(){f.push(b(this).attr("id").replace(/^(ttle)/i,""))});var h=b('#wpgs-download-data input[name="_wpgs_regprice"]').val();var e={action:"wpgs_save_bulk_edit",wpgs_bulk_nonce:f,post_ids:f,price:h};b.post(ajaxurl,e)});b(".wpgs-select-chosen").chosen();if(b(".wpgs-color-picker").length){b(".wpgs-color-picker").wpColorPicker()}});
